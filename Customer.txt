 PROCEDURE `SP_AddandEditCustomer`(
IN c_action ENUM('ADD','GETONE','UPDATE','DELETE','VIEW'),
 IN c_hotelname VARCHAR(150),
 IN c_location VARCHAR(50),
 IN c_spocname VARCHAR(150),
 IN c_mail VARCHAR(255),
 IN c_mobileno VARCHAR(15),
 IN c_address VARCHAR(255),
 IN c_brandid INT(11),
 IN c_locid INT(11),
 IN c_createdBy INT(11))
LABEL_EXIT:
BEGIN

	DECLARE htlnmecnt,htluniqecnt,brnhotelcnt,p_brandid,oldstat,oldbrandid INT(11);
    DECLARE currDate DATETIME;
    DECLARE p_hotelName,p_spocname,oldhotelname,oldspocname varchar(150);
    DECLARE p_location,oldlocation varchar(50);
    DECLARE p_mail,p_address,oldmail,oldaddress VARCHAR(255);
    DECLARE p_mobileno,oldmoblieno VARCHAR(15);
    
      DECLARE CONTINUE HANDLER FOR NOT FOUND
		BEGIN
			-- SELECT '01' as ErrroCode  , 'NO DATA' as ErrorMessage;	
		END;
        
       	DECLARE exit handler for sqlexception
			BEGIN         
				GET DIAGNOSTICS CONDITION 1
					@e1 = MYSQL_ERRNO, @e2 = MESSAGE_TEXT;
					 SELECT @e1 as ErrroCode  , @e2 as Result;	 
				ROLLBACK;
			END;
 		DECLARE exit handler for sqlwarning
			BEGIN
				GET DIAGNOSTICS CONDITION 1
					@e1 = MYSQL_ERRNO, @e2 = MESSAGE_TEXT;
					 SELECT @e1 as ErrroCode  , @e2 as Result; 
				ROLLBACK;
			END;

	  START TRANSACTION;    
		SET currDate = sysdate();
		SET p_hotelName = trim(c_hotelName);
		SET p_location = trim(c_location);
        SET p_spocname = trim(c_spocname);
		SET p_mail = trim(c_mail);
        SET p_mobileno = trim(c_mobileno);
		SET p_address = trim(c_address);        
        SET p_brandid = trim(c_brandid);
   
	IF (c_action = 'ADD') THEN
    
		IF (p_brandid = 0) THEN
			SELECT "Brand Id Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
		
		IF (p_hotelName is null or p_hotelName = '') THEN
			SELECT "Hotel Name Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
        
        IF (p_location is null or p_location = '') THEN
			SELECT "Location Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_spocname is null or p_spocname = '') THEN
			SELECT "SpocName Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_mail is null or p_mail = '') THEN
			SELECT "Mail Id Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_mobileno is null or p_mobileno = '') THEN
			SELECT "MobileNo Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_address is null or p_address = '') THEN
			SELECT "Address Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
		
        
		SELECT count(*) into brnhotelcnt from locations where hotelname = p_hotelName and  brandid = p_brandid;
        IF (brnhotelcnt >=1) THEN
			SELECT "Customer Already Added" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;

       insert into locations (brandid,hotelname, custmail, location,  mobileno, spocname, address, status, createdBy, 
       createdOn)
       values (p_brandid,p_hotelName,p_mail,p_location,p_mobileno,p_spocname,p_address,1,c_createdBy,currDate);
       
      SELECT "Customer Added SuccessFully" as 'msg', "Success" as status;
      
	ELSEIF(c_action = 'EDIT')THEN  
     
        IF (c_locid = 0) THEN
			SELECT "Hotel id empty" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
        select * from locations where id = c_locid;
	    
   ElSEIF(c_action = 'UPDATE') THEN    
    
		IF (p_brandid = 0) THEN
			SELECT "Brand Id Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
		
		IF (p_hotelName is null or p_hotelName = '') THEN
			SELECT "Hotel Name Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
        
        IF (p_location is null or p_location = '') THEN
			SELECT "Location Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_spocname is null or p_spocname = '') THEN
			SELECT "SpocName Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_mail is null or p_mail = '') THEN
			SELECT "Mail Id Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_mobileno is null or p_mobileno = '') THEN
			SELECT "MobileNo Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        
        IF (p_address is null or p_address = '') THEN
			SELECT "Address Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;

	
	 SELECT brandid, hotelname, custmail, location, mobileno, spocname, address, status 
	 into oldbrandid,oldhotelname,oldmail,oldlocation,oldmoblieno,oldspocname,
	 oldaddress,oldstat  from locations where id=c_locid;
        
			IF (oldbrandid <> p_brandid) THEN
				update locations set brandid = p_brandid,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_locid;
			END IF;
            
			IF (oldhotelname <> p_hotelName) THEN
				update locations set hotelname = p_hotelName,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_locid;
			END IF;
            
            IF (oldmail <> p_mail) THEN
				update locations set custmail = p_mail,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_locid;
			END IF;
            
            IF (oldlocation <> p_location) THEN
				update locations set location = p_location,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_locid;
			END IF;
            
            IF (oldmoblieno <> p_mobileno) THEN
				update locations set mobileno = p_mobileno,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_locid;
			END IF;
            			  
            IF (oldspocname <> p_spocname) THEN
				update locations set spocname = p_spocname,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_locid;
			END IF;            
  
            IF (oldaddress <> p_address) THEN
				update locations set address = p_address,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_locid;
			END IF;           
            
         SELECT "Customer Updated SuccessFully" as 'msg', "Success" as status;
         
   ELSEIF(c_action = 'GETONE')THEN  
     
        IF (c_locid = 0) THEN
			SELECT "Hotel id empty" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
        select lc.brandid,bs.brandname, lc.hotelname, lc.custmail, lc.location,lc. mobileno, lc.spocname, lc.address, lc.status  from locations 
        as lc left join brand_details as bs on lc.brandid = bs.id where lc.id = c_locid;
        
	ELSEIF(c_action = 'DELETE')THEN 
    
      SELECT count(*) into htlnmecnt from locations where  id=c_locid;
      IF(htlnmecnt = 0)THEN
			SELECT "Invalid hotel id" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;		
      END IF;
      
		delete from locations where id=c_locid; 
    	
		SELECT "Customer Removed Successfully" as 'msg', "Success" as status;

    ELSEIF(c_action = 'VIEW')THEN     
        
        SELECT lc.id, lc.brandid, lc.hotelname, lc.custmail, lc.location, lc.mobileno, lc.spocname, lc.address, lc.status, lc.createdBy, lc.createdOn
			,bs.brandname,lc.tempid  FROM ottproduct.locations as lc left join brand_details as bs on lc.brandid = bs.id order by lc.createdOn desc;
    
    END IF;    
    
    COMMIT;
END