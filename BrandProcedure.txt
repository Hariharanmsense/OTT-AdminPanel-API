PROCEDURE `SP_AddandEditBrand`(
IN c_action ENUM('ADD','GETONE','UPDATE','DELETE','VIEW','ACTORDEACT'),
 IN c_brandName VARCHAR(150),
 IN c_shortName VARCHAR(50),
 IN c_createdBy INT(11),
 IN c_brandid INT(11))
LABEL_EXIT:
BEGIN

	DECLARE brandnmecnt,shortnmecnt,brndcnt,p_actstatus INT(11);
    DECLARE currDate DATETIME;
    DECLARE p_brandName,oldbrndname varchar(150);
    DECLARE p_shortName,oldshortname varchar(50);
    
      DECLARE CONTINUE HANDLER FOR NOT FOUND
		BEGIN
			-- SELECT '01' as ErrroCode  , 'NO DATA' as ErrorMessage;	
		END;
        
       	DECLARE exit handler for sqlexception
			BEGIN         
				GET DIAGNOSTICS CONDITION 1
					@e1 = MYSQL_ERRNO, @e2 = MESSAGE_TEXT;
					 SELECT @e1 as ErrroCode  , @e2 as Result;	 
				ROLLBACK;
			END;
 		DECLARE exit handler for sqlwarning
			BEGIN
				GET DIAGNOSTICS CONDITION 1
					@e1 = MYSQL_ERRNO, @e2 = MESSAGE_TEXT;
					 SELECT @e1 as ErrroCode  , @e2 as Result; 
				ROLLBACK;
			END;

	  START TRANSACTION;    
	SET currDate = sysdate();
    SET p_brandName = trim(c_brandName);
    SET p_shortName = trim(c_shortName);
   
	IF (c_action = 'ADD') THEN
		IF (p_brandName is null or p_brandName = '') THEN
			SELECT "Brand Name Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
		IF (p_shortName is null or p_shortName = '') THEN
			SELECT "Short Name Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
		SELECT count(*) into brndcnt from brand_details where brandname = p_brandName and shortname = p_shortName;
        IF (brndcnt >=1) THEN
			SELECT "Brand Already Added" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        SELECT count(*) into brandnmecnt from brand_details where brandname = p_brandName;
        IF (brandnmecnt >=1) THEN
			SELECT "Brand Name Already Added" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        SELECT count(*) into shortnmecnt from brand_details where shortname = p_shortName;
        IF (shortnmecnt >=1) THEN
			SELECT "Short Name Already Added" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;

       insert into brand_details (brandname,shortname,is_active,createdBy,createdOn) values
       (p_brandName,p_shortName,1,c_createdBy,currDate);
       
      SELECT "Brand Added SuccessFully" as 'msg', "Success" as status;
	    
   ElSEIF(c_action = 'UPDATE') THEN    
    
		IF (c_brandid = 0) THEN
			SELECT "Brand id empty" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
		IF (p_brandName is null or p_brandName = '') THEN
			SELECT "Brand Name Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
		IF (p_shortName is null or p_shortName = '') THEN
			SELECT "Short Name Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;	 
		END IF;
        SET brndcnt = 0;
		SELECT count(*) into brndcnt from brand_details where  id=c_brandid;
        
			IF (brndcnt = 0) THEN
				SELECT "Invalid Brand" as 'msg', "FAILURE" as status;
				leave LABEL_EXIT;	
			END IF;
            SELECT brandname,shortname into oldbrndname,oldshortname from brand_details where  id=c_brandid;
			IF (oldbrndname <> p_brandName) THEN
				update brand_details set brandname = p_brandName,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_brandid;
			END IF;
			IF (oldshortname <> p_shortName) THEN
				update brand_details set shortname = p_shortName,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_brandid;
			END IF;
            
         SELECT "Brand Updated SuccessFully" as 'msg', "Success" as status;
         
   ELSEIF(c_action = 'GETONE')THEN  
     
        IF (c_brandid = 0) THEN
			SELECT "Brand id empty" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
		END IF;
        SET brndcnt = 0;
        SELECT count(*) into brndcnt from brand_details where  id=c_brandid;
        IF (brndcnt = 0) THEN
				SELECT "No Record Found" as 'msg', "FAILURE" as status;
				leave LABEL_EXIT;	
			END IF;
        select brandname,shortname from brand_details where id = c_brandid;
        
	ELSEIF(c_action = 'DELETE')THEN 
    
      SELECT count(*) into brandnmecnt from brand_details where  id=c_brandid;
      
      IF(brandnmecnt = 0)THEN
			SELECT "Invalid Brand" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;		
      END IF;
		delete from brand_details where id=c_brandid;     	
		SELECT "Brand Removed Successfully" as 'msg', "Success" as status;
    
    ELSEIF(c_action = 'VIEW')THEN     
    
		select brn.id as brandid,brn.brandname,brn.shortname,brn.createdOn,au.userName as createdByName from brand_details as brn
        left join adminusers as au on brn.createdBy = au.id;
        
	ELSEIF(c_action = 'ACTORDEACT')THEN  
		
        IF(c_brandid=0) THEN
			SELECT "Brand Required" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
        END IF;
        select count(*) into brndcnt from  brand_details where id = c_brandid;
        IF (brndcnt=0)THEN
        SELECT "No Records Found" as 'msg', "FAILURE" as status;
			leave LABEL_EXIT;
        END IF;
        select is_active into p_actstatus from brand_details where id = c_brandid;
        
        IF(p_actstatus = 1)THEN
			update brand_details set is_active = 0,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_brandid;
        ELSE 
			update brand_details set is_active = 1,modifiedBy=c_createdBy,modifiedOn=currDate where id=c_brandid;
        END IF;
		SELECT "Brand Status Updated SuccessFully" as 'msg', "Success" as status;
    
    END IF;    
    
    COMMIT;
END